name: Auto Generate and Index New Posts

on:
  push:
    branches:
      - main # ØªØ£ÙƒØ¯ Ù…Ù† Ø£Ù† Ù‡Ø°Ø§ Ù‡Ùˆ Ø§Ø³Ù… Ø§Ù„ÙØ±Ø¹ Ø§Ù„Ø±Ø¦ÙŠØ³ÙŠ Ù„Ø¯ÙŠÙƒ
    paths:
      - 'titles.txt' # ØªØ´ØºÙŠÙ„ Ø§Ù„Ù€ Workflow Ø¹Ù†Ø¯ ØªØ­Ø¯ÙŠØ« Ù…Ù„Ù Ø§Ù„Ø¹Ù†Ø§ÙˆÙŠÙ† ÙÙ‚Ø·
  workflow_dispatch: # ÙŠØ³Ù…Ø­ Ø¨ØªØ´ØºÙŠÙ„Ù‡ ÙŠØ¯ÙˆÙŠØ§Ù‹ Ù…Ù† ÙˆØ§Ø¬Ù‡Ø© Actions

jobs:
  generate:
    runs-on: ubuntu-latest
    permissions:
      contents: write # ØµÙ„Ø§Ø­ÙŠØ© Ø§Ù„ÙƒØªØ§Ø¨Ø© Ù„Ù€ GITHUB_TOKEN Ù„Ø¹Ù…Ù„ Push
    steps:
      - name: Checkout repository
        uses: actions/checkout@v4
        with:
          token: ${{ secrets.GITHUB_TOKEN }}
          
      - name: Set up Python
        uses: actions/setup-python@v4
        with:
          python-version: '3.11'

      - name: Install dependencies (requests)
        run: |
          pip install -r requirements.txt
          
      - name: Generate Article and Update Index
        env:
          # ØªÙ…Ø±ÙŠØ± Ù…ÙØªØ§Ø­ API ÙƒÙ…ØªØºÙŠØ± Ø¨ÙŠØ¦Ø© Ù„Ù„Ø³ÙƒØ±Ø¨Øª
          HF_TOKEN: ${{ secrets.HF_TOKEN }} 
        run: |
          echo "Starting article generation..."
          
          # 1. ØªØ´ØºÙŠÙ„ Ø³ÙƒØ±Ø¨Øª Ø§Ù„ØªÙˆÙ„ÙŠØ¯ (ÙŠÙ‚Ø±Ø£ Ù…Ù† titles.txt ÙˆÙŠØ­ÙØ¸ ÙÙŠ posts/)
          python generate_post.py

          echo "Starting index update..."
          
          # 2. ØªØ´ØºÙŠÙ„ Ø³ÙƒØ±Ø¨Øª ØªØ­Ø¯ÙŠØ« Ø§Ù„ÙÙ‡Ø±Ø³ (ÙŠÙ‚Ø±Ø£ posts/ ÙˆÙŠØ­Ø¯Ø« index.json)
          python update_index.py
          
          # 3. Ø¥Ø¹Ø¯Ø§Ø¯ Git ÙˆØ§Ù„Ø¥Ø±Ø³Ø§Ù„ (Push)
          git config user.name "Auto-Generator Action"
          git config user.email "actions@github.com"
          
          # Ø¥Ø¶Ø§ÙØ© Ø¬Ù…ÙŠØ¹ Ø§Ù„Ù…Ù„ÙØ§Øª Ø§Ù„ØªÙŠ ØªÙ… ØªØºÙŠÙŠØ±Ù‡Ø§ (posts/, index.json, titles.txt, log.txt)
          git add posts/
          git add index.json
          git add titles.txt
          git add log.txt

          # 4. Ø§Ù„ØªØ­Ù‚Ù‚ Ù…Ù† ÙˆØ¬ÙˆØ¯ ØªØºÙŠÙŠØ±Ø§Øª Ù„Ù€ Commit
          if git status --porcelain | grep -q .; then
            echo "Changes detected. Committing and pushing..."
            git commit -m "ğŸ¤– Auto-generated post and updated index."
            git push
          else
            echo "No new changes. Skipping commit."
          fi
